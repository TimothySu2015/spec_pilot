# SpecPilot AI è¨ºæ–·åŠŸèƒ½å¯¦ä½œè¨ˆåŠƒ

> **âœ… å¯¦ä½œç‹€æ…‹**: éšæ®µ 1-3 èˆ‡éšæ®µ 5 å·²å®Œæˆ (2025-09-30)
>
> - âœ… éšæ®µ 1: å¢å¼·éŒ¯èª¤å ±è¡¨
> - âœ… éšæ®µ 2: å»ºç«‹è¨ºæ–·ä¸Šä¸‹æ–‡ç”Ÿæˆå™¨
> - âœ… éšæ®µ 3: æ•´åˆè¨ºæ–·ä¸Šä¸‹æ–‡åˆ° MCP
> - âœ… éšæ®µ 4: æ–‡ä»¶èˆ‡ç¯„ä¾‹
> - âœ… éšæ®µ 5: æ¸¬è©¦èˆ‡é©—è­‰ (17/17 å–®å…ƒæ¸¬è©¦é€šé)
> - â¸ï¸ éšæ®µ 6: æœ€çµ‚é©—è­‰èˆ‡ç™¼å¸ƒ (å¯é¸)

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

### ç›®æ¨™
åœ¨ SpecPilot ä¸­å»ºç«‹ AI é©…å‹•çš„éŒ¯èª¤è¨ºæ–·åŠŸèƒ½,é€é Claude Desktop åˆ†æ API æ¸¬è©¦å¤±æ•—åŸå› ä¸¦æä¾›ä¿®å¾©å»ºè­°ã€‚

### æ ¸å¿ƒç†å¿µ
- **é€é Claude Desktop é€²è¡Œè¨ºæ–·** - åˆ©ç”¨ä½¿ç”¨è€…çš„ Claude Pro è¨‚é–±
- **API éŒ¯èª¤è¨Šæ¯ç‚ºæ ¸å¿ƒ** - ä¿ç•™å®Œæ•´çš„éŒ¯èª¤å›æ‡‰å…§å®¹ (åŒ…å« stack trace)
- **æœ¬æ©Ÿé–‹ç™¼éšæ®µä½¿ç”¨** - ä¸ç”¨æ–¼æ­£å¼ç’°å¢ƒ,å®‰å…¨æ€§è¦æ±‚è¼ƒä½
- **è¨ºæ–·å‹å–„çš„éŒ¯èª¤æ ¼å¼** - åˆ¶å®š API é–‹ç™¼è¦ç¯„,ç¢ºä¿éŒ¯èª¤è¨Šæ¯çµæ§‹åŒ–

### é æœŸæ•ˆæœ
- è¨ºæ–·æˆåŠŸç‡: **85-90%** (é‡å°å¸¸è¦‹éŒ¯èª¤)
- ä½¿ç”¨æ–¹å¼: åœ¨ Claude Desktop ä¸­é€é MCP å·¥å…·äº’å‹•
- é©ç”¨å ´æ™¯: API é–‹ç™¼ã€æ¸¬è©¦ã€é™¤éŒ¯éšæ®µ

---

## ğŸ”„ å®Œæ•´æµç¨‹åœ–

### æ•´é«”æ¶æ§‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ä½¿ç”¨è€… (é–‹ç™¼è€…)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Claude Desktop                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ User: åŸ·è¡Œæ¸¬è©¦ä¸¦è¨ºæ–·éŒ¯èª¤                                      â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚ @mcp__specpilot__runFlow spec=api.yaml flow=test.yaml       â”‚     â”‚
â”‚  â”‚   â†“ (æ¸¬è©¦åŸ·è¡Œ,éƒ¨åˆ†å¤±æ•—)                                      â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚ @mcp__specpilot__getReport                                   â”‚     â”‚
â”‚  â”‚   â†“ (å–å¾—åŒ…å«è¨ºæ–·ä¸Šä¸‹æ–‡çš„å ±è¡¨)                               â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚ Claude åˆ†æè¨ºæ–·ä¸Šä¸‹æ–‡:                                        â”‚     â”‚
â”‚  â”‚ - è®€å–å®Œæ•´éŒ¯èª¤è¨Šæ¯ (åŒ…å« stack trace)                        â”‚     â”‚
â”‚  â”‚ - ç†è§£éŒ¯èª¤åˆ†é¡ (auth/network/validation/server)             â”‚     â”‚
â”‚  â”‚ - æŸ¥çœ‹éŒ¯èª¤æ¨¡å¼ (é€£çºŒå¤±æ•—ã€é€£é–åæ‡‰)                          â”‚     â”‚
â”‚  â”‚ - åƒè€ƒè¨ºæ–·æç¤º                                                â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚ Claude å›æ‡‰:                                                  â”‚     â”‚
â”‚  â”‚ âœ… ç²¾ç¢ºçš„å•é¡Œè¨ºæ–·                                             â”‚     â”‚
â”‚  â”‚ âœ… æ ¹æœ¬åŸå› åˆ†æ                                               â”‚     â”‚
â”‚  â”‚ âœ… å…·é«”çš„ä¿®å¾©æ­¥é©Ÿ                                             â”‚     â”‚
â”‚  â”‚ âœ… ç¨‹å¼ç¢¼ç¯„ä¾‹ (å¦‚éœ€è¦)                                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ (MCP å”è­°)
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SpecPilot MCP Server                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ handleRunFlow()                                               â”‚     â”‚
â”‚  â”‚   â†’ åŸ·è¡Œæ¸¬è©¦                                                  â”‚     â”‚
â”‚  â”‚   â†’ ç”Ÿæˆå ±è¡¨ (åŒ…å«å®Œæ•´éŒ¯èª¤è³‡è¨Š)                              â”‚     â”‚
â”‚  â”‚   â†’ å„²å­˜åˆ° reports/result.json                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ handleGetReport()                                             â”‚     â”‚
â”‚  â”‚   â†’ è¼‰å…¥å ±è¡¨                                                  â”‚     â”‚
â”‚  â”‚   â†’ å»ºç«‹è¨ºæ–·ä¸Šä¸‹æ–‡ (DiagnosticContextBuilder)                â”‚     â”‚
â”‚  â”‚   â†’ å›å‚³å ±è¡¨ + è¨ºæ–·ä¸Šä¸‹æ–‡                                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¸¬è©¦å ±è¡¨ç”Ÿæˆæµç¨‹                                   â”‚
â”‚                                                                         â”‚
â”‚  Step 1: HTTP è«‹æ±‚åŸ·è¡Œ                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ HTTP Runner åŸ·è¡Œ API è«‹æ±‚                            â”‚              â”‚
â”‚  â”‚   â†’ æˆåŠŸ: å–å¾—å›æ‡‰                                   â”‚              â”‚
â”‚  â”‚   â†’ å¤±æ•—: å–å¾—éŒ¯èª¤å›æ‡‰ (å« stack trace)             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                         â”‚
â”‚  Step 2: å ±è¡¨ç”Ÿæˆ (ReportGenerator)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ IF æ¸¬è©¦å¤±æ•—:                                         â”‚              â”‚
â”‚  â”‚   âœ… ä¿ç•™å®Œæ•´éŒ¯èª¤ body                               â”‚              â”‚
â”‚  â”‚   âœ… ä¿ç•™éŒ¯èª¤ headers                                â”‚              â”‚
â”‚  â”‚   âœ… æå– stack trace                                â”‚              â”‚
â”‚  â”‚   âœ… è¨˜éŒ„å›æ‡‰æ™‚é–“                                    â”‚              â”‚
â”‚  â”‚   âš ï¸  é®ç½©æ•æ„Ÿè³‡æ–™ (password, token, etc.)          â”‚              â”‚
â”‚  â”‚                                                      â”‚              â”‚
â”‚  â”‚ IF æ¸¬è©¦æˆåŠŸ:                                         â”‚              â”‚
â”‚  â”‚   âœ… åªä¿ç•™ hash (ç¯€çœç©ºé–“)                          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                         â”‚
â”‚  Step 3: è¨ºæ–·ä¸Šä¸‹æ–‡å»ºç«‹ (DiagnosticContextBuilder)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 1. åˆ†æå¤±æ•—æ­¥é©Ÿ                                      â”‚              â”‚
â”‚  â”‚    â†’ éŒ¯èª¤åˆ†é¡ (auth/network/validation/server)      â”‚              â”‚
â”‚  â”‚    â†’ ä¿¡å¿ƒåº¦è©•åˆ† (0-100)                              â”‚              â”‚
â”‚  â”‚    â†’ åˆ¤æ–·ä¾æ“šè¨˜éŒ„                                    â”‚              â”‚
â”‚  â”‚                                                      â”‚              â”‚
â”‚  â”‚ 2. åµæ¸¬éŒ¯èª¤æ¨¡å¼                                      â”‚              â”‚
â”‚  â”‚    â†’ é€£çºŒèªè­‰å¤±æ•—?                                   â”‚              â”‚
â”‚  â”‚    â†’ é€£é–å¤±æ•—? (ç¬¬ä¸€æ­¥å¤±æ•—å°è‡´å¾ŒçºŒå¤±æ•—)             â”‚              â”‚
â”‚  â”‚    â†’ å…¨éƒ¨ç¶²è·¯éŒ¯èª¤? (API æœªå•Ÿå‹•)                     â”‚              â”‚
â”‚  â”‚                                                      â”‚              â”‚
â”‚  â”‚ 3. ç”Ÿæˆè¨ºæ–·æç¤º                                      â”‚              â”‚
â”‚  â”‚    â†’ å¿«é€Ÿè¨ºæ–·æ‘˜è¦                                    â”‚              â”‚
â”‚  â”‚    â†’ å¯èƒ½åŸå› åˆ—è¡¨                                    â”‚              â”‚
â”‚  â”‚    â†’ å»ºè­°çš„ä¿®å¾©å‹•ä½œ                                  â”‚              â”‚
â”‚  â”‚    â†’ å»ºè­°è©¢å•çš„å•é¡Œ                                  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤” è¨­è¨ˆæ±ºç­–èˆ‡ç†ç”±

### ç‚ºä»€éº¼è¦ä¿ç•™å®Œæ•´éŒ¯èª¤è¨Šæ¯?

#### å•é¡Œ: ç›®å‰åªæœ‰ Hash

```typescript
// ç›®å‰çš„å ±è¡¨
response: {
  bodyHash: "sha256:abc123..."  // âŒ Claude çœ‹ä¸åˆ°å…§å®¹
}
```

**å•é¡Œ**:
- âŒ Claude ç„¡æ³•è®€å–å¯¦éš›çš„éŒ¯èª¤è¨Šæ¯
- âŒ ç„¡æ³•çœ‹åˆ° API å›å‚³çš„ stack trace
- âŒ ç„¡æ³•ç†è§£å…·é«”çš„å¤±æ•—åŸå› 
- âŒ åªèƒ½æ ¹æ“š HTTP ç‹€æ…‹ç¢¼çŒœæ¸¬

**çµæœ**: è¨ºæ–·æˆåŠŸç‡åªæœ‰ 40-50%

#### è§£æ±ºæ–¹æ¡ˆ: å¤±æ•—æ™‚ä¿ç•™å®Œæ•´å…§å®¹

```typescript
// æ”¹é€²å¾Œçš„å ±è¡¨
response: {
  bodyHash: "sha256:abc123...",
  errorDetails: {  // âœ¨ å¤±æ•—æ™‚æ‰æœ‰
    body: {
      error: "TOKEN_EXPIRED",
      message: "JWT Token å·²æ–¼ 10:30 éæœŸ",
      hint: "è«‹ä½¿ç”¨ /auth/refresh åˆ·æ–°",
      stack_trace: [...]
    }
  }
}
```

**å„ªé»**:
- âœ… Claude å¯ä»¥è®€å–å®Œæ•´éŒ¯èª¤è¨Šæ¯
- âœ… çœ‹å¾—åˆ° API é–‹ç™¼è€…æä¾›çš„ä¿®å¾©æç¤º
- âœ… Stack trace æä¾›ç¨‹å¼ç¢¼å±¤ç´šçš„è¨ºæ–·
- âœ… è¨ºæ–·æˆåŠŸç‡æå‡åˆ° 70-80% (API éœ€éµå®ˆè¦ç¯„æ™‚å¯é” 85-90%)

**æ¬Šè¡¡**:
- âš ï¸ å ±è¡¨æª”æ¡ˆè®Šå¤§ (ä½†åªåœ¨å¤±æ•—æ™‚)
- âš ï¸ éœ€è¦è™•ç†æ•æ„Ÿè³‡æ–™é®ç½©
- âœ… åªåœ¨æœ¬æ©Ÿé–‹ç™¼ä½¿ç”¨,å®‰å…¨æ€§å¯æ§

**ğŸ“– ç›¸é—œæ–‡ä»¶**: è«‹åƒè€ƒ [API éŒ¯èª¤è™•ç†æ¨™æº–åŒ–æŒ‡å—](./guides/api-errors/api-error-handling-guide.md) äº†è§£å¦‚ä½•è¨­è¨ˆè¨ºæ–·å‹å–„çš„ API éŒ¯èª¤æ ¼å¼

---

### ç‚ºä»€éº¼éœ€è¦è¨ºæ–·ä¸Šä¸‹æ–‡ (Diagnostic Context)?

#### å•é¡Œ: åŸå§‹å ±è¡¨å° AI ä¸å¤ å‹å–„

```typescript
// åŸå§‹å ±è¡¨ - éœ€è¦ AI è‡ªå·±åˆ†æ
{
  steps: [
    { name: "ç™»å…¥", statusCode: 401, validationResults: [...] },
    { name: "å–å¾—è³‡æ–™", statusCode: 401, validationResults: [...] },
    { name: "æ›´æ–°è³‡æ–™", statusCode: 401, validationResults: [...] }
  ]
}
```

**å•é¡Œ**:
- âŒ AI éœ€è¦èŠ±æ™‚é–“åˆ†æéŒ¯èª¤é¡å‹
- âŒ ç„¡æ³•ä¸€çœ¼çœ‹å‡ºéŒ¯èª¤æ¨¡å¼ (3 å€‹æ­¥é©Ÿéƒ½æ˜¯èªè­‰å¤±æ•—)
- âŒ ç¼ºå°‘è¨ºæ–·æç¤º
- âŒ éœ€è¦æ›´å¤š Token å’Œæ™‚é–“

#### è§£æ±ºæ–¹æ¡ˆ: é å…ˆåˆ†æä¸¦çµæ§‹åŒ–

```typescript
// è¨ºæ–·ä¸Šä¸‹æ–‡ - é å…ˆåˆ†æå¥½çš„è³‡è¨Š
{
  diagnosticContext: {
    quickDiagnosis: "3 å€‹æ­¥é©Ÿå¤±æ•—,ä¸»è¦æ˜¯èªè­‰å•é¡Œ",

    errorPatterns: [{
      pattern: "consecutive_auth_failures",
      description: "é€£çºŒèªè­‰å¤±æ•—",
      likelihood: "high"
    }],

    diagnosticHints: {
      likelyCauses: ["Token éæœŸ", "Token ç„¡æ•ˆ"],
      suggestedActions: ["æ›´æ–° Token", "æª¢æŸ¥ .env.local"]
    }
  }
}
```

**å„ªé»**:
- âœ… Claude ç«‹å³ç†è§£å•é¡Œæœ¬è³ª
- âœ… æ¸›å°‘åˆ†ææ™‚é–“å’Œ Token æ¶ˆè€—
- âœ… è¨ºæ–·æç¤ºå¼•å° Claude çµ¦å‡ºæ›´å¥½çš„å»ºè­°
- âœ… éŒ¯èª¤æ¨¡å¼åµæ¸¬æé«˜è¨ºæ–·æº–ç¢ºåº¦

**ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆ**:
1. **ç¯€çœ AI æ¨ç†æ™‚é–“** - é å…ˆåšå¥½åŸºç¤åˆ†æ
2. **æé«˜è¨ºæ–·æº–ç¢ºåº¦** - åŸºæ–¼è¦å‰‡çš„åˆ†é¡å¾ˆå¯é 
3. **æä¾›è¨ºæ–·æ–¹å‘** - é¿å… AI åé›¢é‡é»
4. **é™ä½æˆæœ¬** - æ¸›å°‘ Token æ¶ˆè€—

---

### ç‚ºä»€éº¼è¦éŒ¯èª¤åˆ†é¡ (Error Classification)?

#### åˆ†é¡é‚è¼¯

```typescript
classifyError(step: IStepResult): ErrorClassification {
  const code = step.response.statusCode;

  if (code === 401 || code === 403) {
    return {
      primaryType: 'auth',
      confidence: 90,
      indicators: ['HTTP 401', 'éŒ¯èª¤è¨Šæ¯åŒ…å« token']
    };
  }
  // ... å…¶ä»–åˆ†é¡
}
```

**ç‚ºä»€éº¼éœ€è¦åˆ†é¡?**

1. **å¿«é€Ÿå®šä½å•é¡Œé ˜åŸŸ**
   - `auth` â†’ èªè­‰ç›¸é—œ,æª¢æŸ¥ Token
   - `network` â†’ é€£ç·šå•é¡Œ,æª¢æŸ¥æœå‹™
   - `validation` â†’ Schema å•é¡Œ,æ¯”å°è¦æ ¼
   - `server` â†’ API å•é¡Œ,æŸ¥çœ‹ä¼ºæœå™¨æ—¥èªŒ

2. **æä¾›ä¿¡å¿ƒåº¦è©•åˆ†**
   - 90%+ â†’ éå¸¸ç¢ºå®š,ç›´æ¥ä¿®å¾©
   - 70-90% â†’ è¼ƒç¢ºå®š,éœ€è¦é©—è­‰
   - <70% â†’ ä¸ç¢ºå®š,éœ€è¦æ›´å¤šè³‡è¨Š

3. **è¨˜éŒ„åˆ¤æ–·ä¾æ“š**
   - Claude å¯ä»¥ç†è§£ç‚ºä»€éº¼é€™æ¨£åˆ†é¡
   - ä½¿ç”¨è€…å¯ä»¥é©—è­‰åˆ†é¡æ˜¯å¦æ­£ç¢º
   - æ–¹ä¾¿å¾ŒçºŒæ”¹é€²åˆ†é¡é‚è¼¯

---

### ç‚ºä»€éº¼è¦åµæ¸¬éŒ¯èª¤æ¨¡å¼ (Error Patterns)?

#### ç¯„ä¾‹: é€£é–å¤±æ•—åµæ¸¬

```typescript
// æ­¥é©Ÿ 1 å¤±æ•— â†’ æ­¥é©Ÿ 2-5 ä¹Ÿå¤±æ•—
if (steps[0].status === 'failure') {
  const subsequentFailures = steps.slice(1).filter(s => s.status === 'failure');

  if (subsequentFailures.length > 0) {
    return {
      pattern: 'cascading_failures',
      description: 'ç¬¬ä¸€æ­¥å¤±æ•—å°è‡´å¾ŒçºŒæ­¥é©Ÿé€£é–å¤±æ•—',
      likelihood: 'high'
    };
  }
}
```

**ç‚ºä»€éº¼é‡è¦?**

1. **é¿å…èª¤è¨º**
   - ä¸è¦æŠŠ 5 å€‹å¤±æ•—ç•¶æˆ 5 å€‹ç¨ç«‹å•é¡Œ
   - å¯¦éš›ä¸Šå¯èƒ½åªéœ€è¦ä¿®å¾©ç¬¬ä¸€å€‹

2. **ç¯€çœæ™‚é–“**
   - ç›´æ¥å‘Šè¨´ Claude: "ä¿®å¥½ç¬¬ä¸€æ­¥å°±è¡Œäº†"
   - ä¸ç”¨é€ä¸€åˆ†ææ¯å€‹å¤±æ•—

3. **æä¾›ç³»çµ±å±¤ç´šçš„æ´å¯Ÿ**
   - é€£çºŒèªè­‰å¤±æ•— â†’ Token é…ç½®å•é¡Œ
   - å…¨éƒ¨ç¶²è·¯éŒ¯èª¤ â†’ API æœå‹™æœªå•Ÿå‹•
   - æŸå€‹è³‡æºçš„æ‰€æœ‰æ“ä½œéƒ½å¤±æ•— â†’ è³‡æºä¸å­˜åœ¨

---

### ç‚ºä»€éº¼è¦è¨ºæ–·æç¤º (Diagnostic Hints)?

#### æç¤ºçš„ä½œç”¨

```typescript
diagnosticHints: {
  quickDiagnosis: "2 å€‹æ­¥é©Ÿå¤±æ•—,ä¸»è¦æ˜¯èªè­‰å•é¡Œ",

  likelyCauses: [
    "JWT Token å·²éæœŸ",
    "API Key è¨­å®šéŒ¯èª¤"
  ],

  suggestedActions: [
    "æ›´æ–° .env.local ä¸­çš„ SPEC_PILOT_TOKEN",
    "ä½¿ç”¨ /auth/refresh ç«¯é»åˆ·æ–° Token"
  ],

  suggestedQuestions: [
    "Token æ˜¯ä»€éº¼æ™‚å€™éæœŸçš„?",
    "å¦‚ä½•å–å¾—æ–°çš„ Token?"
  ]
}
```

**ç‚ºä»€éº¼éœ€è¦æç¤º?**

1. **å¼•å° Claude çš„æ€è€ƒæ–¹å‘**
   - ä¸æ˜¯è®“ AI å¾é›¶é–‹å§‹æ¨ç†
   - æä¾›è¨ºæ–·çš„èµ·é»å’Œæ–¹å‘

2. **æä¾›å¯æ“ä½œçš„å»ºè­°**
   - ä¸åªèªª"Token æœ‰å•é¡Œ"
   - å…·é«”èªªæ˜"æ›´æ–° .env.local ä¸­çš„ SPEC_PILOT_TOKEN"

3. **å¹«åŠ©ä½¿ç”¨è€…ç†è§£å•é¡Œ**
   - å³ä½¿ä¸å• Claude,çœ‹åˆ°æç¤ºå°±çŸ¥é“è©²åšä»€éº¼
   - é™ä½å° AI çš„ä¾è³´

4. **æ¨™æº–åŒ–è¨ºæ–·æµç¨‹**
   - ç¢ºä¿è¨ºæ–·å“è³ªä¸€è‡´
   - é¿å… Claude å¤©é¦¬è¡Œç©ºçš„çŒœæ¸¬

---

### ç‚ºä»€éº¼è¦æ•æ„Ÿè³‡æ–™é®ç½©?

#### é®ç½©é‚è¼¯

```typescript
maskSensitiveFields(obj: any): any {
  const sensitiveKeys = ['password', 'token', 'secret', 'apiKey'];

  for (const [key, value] of Object.entries(obj)) {
    if (sensitiveKeys.some(sk => key.toLowerCase().includes(sk))) {
      result[key] = '***';  // é®ç½©
    } else {
      result[key] = value;  // ä¿ç•™
    }
  }
}
```

**ç‚ºä»€éº¼å³ä½¿åœ¨æœ¬æ©Ÿä¹Ÿè¦é®ç½©?**

1. **é¤Šæˆå¥½ç¿’æ…£**
   - å³ä½¿æ˜¯é–‹ç™¼ç’°å¢ƒä¹Ÿä¸æš´éœ²å¯†ç¢¼
   - é¿å…ä¸å°å¿ƒåˆ†äº«åŒ…å«å¯†ç¢¼çš„å ±è¡¨

2. **å ±è¡¨å¯èƒ½è¢«åˆ†äº«**
   - é–‹ç™¼è€…å¯èƒ½æŠŠå ±è¡¨è²¼åˆ° Slack è©¢å•
   - å ±è¡¨å¯èƒ½è¢« commit åˆ° Git

3. **ç‚ºæœªä¾†æ“´å……åšæº–å‚™**
   - æœªä¾†å¯èƒ½åœ¨æ¸¬è©¦ç’°å¢ƒä½¿ç”¨
   - é®ç½©é‚è¼¯å·²ç¶“å»ºç«‹å¥½äº†

4. **ä¿ç•™è¨ºæ–·è³‡è¨Š**
   - åªé®ç½©å€¼,ä¸é®ç½©æ¬„ä½åç¨±
   - Claude ä»ç„¶çŸ¥é“"æœ‰ password æ¬„ä½"

**ç¯„ä¾‹**:
```typescript
// åŸå§‹
{ "password": "secret123", "email": "user@example.com" }

// é®ç½©å¾Œ
{ "password": "***", "email": "user@example.com" }

// Claude ä»ç„¶çŸ¥é“:
// - æœ‰ password æ¬„ä½ (å¯èƒ½ç›¸é—œ)
// - email æ˜¯æ­£å¸¸çš„
```

---

### ç‚ºä»€éº¼åˆ†éšæ®µé–‹ç™¼?

#### éšæ®µåŠƒåˆ†åŸå‰‡

```
éšæ®µ 1: è³‡æ–™å±¤ (å ±è¡¨)
  â†“ æœ‰è³‡æ–™æ‰èƒ½åˆ†æ
éšæ®µ 2: åˆ†æå±¤ (è¨ºæ–·ä¸Šä¸‹æ–‡)
  â†“ æœ‰åˆ†ææ‰èƒ½å±•ç¤º
éšæ®µ 3: å±•ç¤ºå±¤ (MCP æ•´åˆ)
  â†“ èƒ½ç”¨äº†å†å¯«æ–‡ä»¶
éšæ®µ 4: æ–‡ä»¶å±¤ (è¦ç¯„èˆ‡ç¯„ä¾‹)
  â†“ æ–‡ä»¶é½Šå…¨å†æ¸¬è©¦
éšæ®µ 5: é©—è­‰å±¤ (æ¸¬è©¦)
  â†“ æ¸¬è©¦é€šéå†ç™¼å¸ƒ
éšæ®µ 6: ç™¼å¸ƒå±¤ (æ–‡ä»¶èˆ‡ç¯„ä¾‹)
```

**ç‚ºä»€éº¼ä¸èƒ½ä¸€æ¬¡åšå®Œ?**

1. **ä¾è³´é—œä¿‚æ˜ç¢º**
   - æ²’æœ‰éŒ¯èª¤è³‡è¨Š,å°±ç„¡æ³•åˆ†æ
   - æ²’æœ‰åˆ†æçµæœ,å°±ç„¡æ³•å±•ç¤º
   - æ¯å€‹éšæ®µéƒ½æ˜¯ä¸‹å€‹éšæ®µçš„åŸºç¤

2. **æ¯éšæ®µå¯é©—è­‰**
   - å®Œæˆéšæ®µ 1 â†’ å¯ä»¥çœ‹åˆ°å ±è¡¨æœ‰éŒ¯èª¤è³‡è¨Š
   - å®Œæˆéšæ®µ 2 â†’ å¯ä»¥çœ‹åˆ°è¨ºæ–·ä¸Šä¸‹æ–‡
   - å®Œæˆéšæ®µ 3 â†’ å¯ä»¥åœ¨ Claude Desktop æ¸¬è©¦
   - éšæ®µæ€§æˆæœæ˜ç¢º

3. **é™ä½é¢¨éšª**
   - å¦‚æœéšæ®µ 1 æœ‰å•é¡Œ,åœ¨éšæ®µ 2 æ‰ç™¼ç¾å°±æ™šäº†
   - æ¯éšæ®µå®Œæˆå¾Œæ¸¬è©¦,åŠæ—©ç™¼ç¾å•é¡Œ

4. **ä¿æŒå°ˆæ³¨**
   - ä¸€æ¬¡åªåšä¸€ä»¶äº‹
   - é¿å…åŒæ™‚è™•ç†å¤ªå¤šè®Šæ›´

---

### ç‚ºä»€éº¼æ¸¬è©¦é€™éº¼é‡è¦?

#### æ¸¬è©¦ç­–ç•¥

```
å–®å…ƒæ¸¬è©¦ (60%)
  â†“ æ¸¬è©¦æ¯å€‹å‡½å¼
æ•´åˆæ¸¬è©¦ (30%)
  â†“ æ¸¬è©¦æ¨¡çµ„é–“äº’å‹•
ç«¯å°ç«¯æ¸¬è©¦ (10%)
  â†“ æ¸¬è©¦å¯¦éš›ä½¿ç”¨å ´æ™¯
```

**ç‚ºä»€éº¼éœ€è¦é€™éº¼å¤šæ¸¬è©¦?**

1. **å–®å…ƒæ¸¬è©¦: ç¢ºä¿é‚è¼¯æ­£ç¢º**
   ```typescript
   test('æ•æ„Ÿæ¬„ä½è¢«æ­£ç¢ºé®ç½©', () => {
     const input = { password: 'secret', email: 'user@ex.com' };
     const result = maskSensitiveFields(input);
     expect(result.password).toBe('***');
     expect(result.email).toBe('user@ex.com');
   });
   ```

2. **æ•´åˆæ¸¬è©¦: ç¢ºä¿æ¨¡çµ„å”ä½œ**
   ```typescript
   test('è¨ºæ–·ä¸Šä¸‹æ–‡æ­£ç¢ºç”Ÿæˆ', async () => {
     const report = createFailedReport();
     const context = builder.build(report);
     expect(context.errorPatterns).toHaveLength(1);
   });
   ```

3. **ç«¯å°ç«¯æ¸¬è©¦: ç¢ºä¿å¯¦éš›å¯ç”¨**
   ```typescript
   test('åœ¨ Claude Desktop ä¸­è¨ºæ–·æˆåŠŸ', async () => {
     // 1. åŸ·è¡Œæ¸¬è©¦ (æœƒå¤±æ•—)
     // 2. å–å¾—å ±è¡¨
     // 3. é©—è­‰è¨ºæ–·ä¸Šä¸‹æ–‡
     // 4. ç¢ºèª Claude èƒ½ç†è§£
   });
   ```

**ç‚ºä»€éº¼è¦ 80% è¦†è“‹ç‡?**
- âœ… ç¢ºä¿é—œéµé‚è¼¯éƒ½è¢«æ¸¬è©¦
- âœ… é‡æ§‹æ™‚æœ‰ä¿¡å¿ƒä¸æœƒç ´å£åŠŸèƒ½
- âœ… æ–°å¢åŠŸèƒ½æ™‚å¯ä»¥é©—è­‰æ²’å½±éŸ¿æ—¢æœ‰åŠŸèƒ½
- âš ï¸ ä¸è¿½æ±‚ 100%,é¿å…éåº¦æ¸¬è©¦

---

## ğŸ¯ è¨­è¨ˆå“²å­¸ç¸½çµ

### æ ¸å¿ƒåŸå‰‡

1. **ä»¥ API éŒ¯èª¤è¨Šæ¯ç‚ºæ ¸å¿ƒ**
   - API é–‹ç™¼è€…æœ€äº†è§£å•é¡Œ
   - éŒ¯èª¤è¨Šæ¯æ˜¯æœ€å¯é çš„è¨ºæ–·ä¾†æº
   - Stack trace æä¾›ç¨‹å¼ç¢¼å±¤ç´šçš„æ´å¯Ÿ

2. **é å…ˆåˆ†æ,æ¸›è¼• AI è² æ“”**
   - åŸºæ–¼è¦å‰‡çš„éŒ¯èª¤åˆ†é¡å¾ˆå¯é 
   - éŒ¯èª¤æ¨¡å¼åµæ¸¬æé«˜æº–ç¢ºåº¦
   - è¨ºæ–·æç¤ºå¼•å° AI æ€è€ƒæ–¹å‘

3. **çµæ§‹åŒ–è³‡è¨Š,æ˜“æ–¼ç†è§£**
   - è¨ºæ–·ä¸Šä¸‹æ–‡æ˜¯ç‚º AI è¨­è¨ˆçš„è³‡æ–™æ ¼å¼
   - æ¸…æ™°çš„çµæ§‹è®“ Claude å¿«é€Ÿç†è§£
   - æ¸›å°‘ Token æ¶ˆè€—å’Œæ¨ç†æ™‚é–“

4. **å®‰å…¨ç¬¬ä¸€,å³ä½¿åœ¨é–‹ç™¼ç’°å¢ƒ**
   - æ•æ„Ÿè³‡æ–™å¿…é ˆé®ç½©
   - é¤Šæˆè‰¯å¥½çš„å®‰å…¨ç¿’æ…£
   - ç‚ºæœªä¾†æ“´å……åšæº–å‚™

5. **å¾ªåºæ¼¸é€²,éšæ®µæ€§é©—è­‰**
   - æ¯å€‹éšæ®µéƒ½æœ‰æ˜ç¢ºç›®æ¨™
   - å®Œæˆå¾Œç«‹å³é©—è­‰
   - é™ä½é¢¨éšª,ä¿æŒå°ˆæ³¨

---

## ğŸ¯ é–‹ç™¼éšæ®µè¦åŠƒ

### ğŸ“Š å¯¦éš›ç¨‹å¼ç¢¼åˆ†æçµæœ (2025-01-15)

ç¶“éå°ç¾æœ‰ç¨‹å¼ç¢¼çš„åˆ†æ (ä¸»è¦åƒè€ƒ `apps/mcp-server/src/handlers/run-flow.ts` å’Œ `packages/core-flow/src/`),ç™¼ç¾:

**âœ… å¥½æ¶ˆæ¯**:
1. è³‡æ–™æµç¨‹æ¸…æ™°: `HttpRunner` â†’ `ValidationEngine` â†’ `ReportingIntegration` â†’ `ReportGenerator`
2. Axios å·²è‡ªå‹•è™•ç† JSON/éJSON å›æ‡‰,ä¸éœ€é¡å¤–è™•ç†
3. ç¾æœ‰ä»‹é¢è¨­è¨ˆè‰¯å¥½,åªéœ€æ“´å……è€Œéé‡æ§‹

**âš ï¸ éœ€è¦è™•ç†çš„å•é¡Œ**:
1. **ç¶²è·¯å±¤ç´šéŒ¯èª¤è™•ç†** (2å°æ™‚) - `HttpClient` throw error éœ€æ”¹ç‚ºå›å‚³è™›æ“¬ response
2. **IStepInput å‹åˆ¥æ“´å……** (2å°æ™‚) - `response` éœ€åŠ å…¥ `body`, `headers`, `responseTime`
3. **æ•æ„Ÿè³‡æ–™é®ç½©å¯¦ä½œ** (3å°æ™‚) - æ–°å¢ `maskSensitiveFields()` å’Œ `maskSensitiveHeaders()`

**ä¿®æ­£å¾Œç¸½å·¥ä½œé‡**: **11 å¤©** (åŸä¼°è¨ˆ 14 å¤©)

---

### éšæ®µ 1: å¢å¼·éŒ¯èª¤å ±è¡¨ (2.5 å¤©) ğŸ”´ æœ€é«˜å„ªå…ˆç´š

**ç›®æ¨™**: è®“å ±è¡¨ä¿ç•™å®Œæ•´çš„éŒ¯èª¤è³‡è¨Š,è€Œä¸æ˜¯åªæœ‰ hash

#### 1.0 å‰ç½®ä¿®æ”¹: è™•ç†ç¶²è·¯å±¤ç´šéŒ¯èª¤ (2 å°æ™‚)

**æª”æ¡ˆ**: `packages/http-runner/src/http-client.ts`

**å•é¡Œ**: ç¬¬ 74-88 è¡Œ catch å€å¡Šæœƒ throw error,å°è‡´ç¶²è·¯éŒ¯èª¤æ™‚æ•´å€‹æµç¨‹ä¸­æ–·

**ä»»å‹™**:
- [ ] ä¿®æ”¹ `catch` å€å¡Š,å›å‚³è™›æ“¬ `IHttpResponse` è€Œä¸æ˜¯æ‹‹å‡ºéŒ¯èª¤
- [ ] è¨­å®š `status: 0` è¡¨ç¤ºç¶²è·¯å±¤ç´šéŒ¯èª¤
- [ ] åœ¨ `data` ä¸­åŒ…å«éŒ¯èª¤è³‡è¨Š (error_code, message)
- [ ] æ›´æ–°ç›¸é—œæ¸¬è©¦

**è®Šæ›´å…§å®¹**:
```typescript
catch (error) {
  const duration = Date.now() - startTime;
  const errorMessage = error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤';
  const errorCode = (error as any).code; // ECONNREFUSED, ETIMEDOUT...

  logger.error(EVENT_CODES.STEP_FAILURE, {
    executionId,
    component: 'http-client',
    method: request.method,
    url: request.url,
    error: errorMessage,
    errorCode,
    duration,
  });

  // âœ¨ å›å‚³è™›æ“¬ response è€Œä¸æ˜¯æ‹‹å‡º
  return {
    status: 0,
    headers: {},
    data: {
      _network_error: true,
      error: 'NETWORK_ERROR',
      message: errorMessage,
      error_code: errorCode,
      url: request.url,
      method: request.method
    },
    duration
  };
}
```

**é©—æ”¶æ¨™æº–**:
- ç¶²è·¯éŒ¯èª¤ä¸æœƒä¸­æ–·æ•´å€‹æ¸¬è©¦æµç¨‹
- å›å‚³çš„ response åŒ…å«éŒ¯èª¤è³‡è¨Š
- ç¾æœ‰æ¸¬è©¦éœ€æ›´æ–°æˆ–æ–°å¢æ¸¬è©¦æ¡ˆä¾‹

---

#### 1.1 æ“´å…… IStepInput å‹åˆ¥å®šç¾© (1 å°æ™‚)

**æª”æ¡ˆ**: `packages/reporting/src/report-generator.ts`

**å•é¡Œ**: ç¬¬ 17-34 è¡Œ `IStepInput.response` ç¼ºå°‘ `body`, `headers`, `responseTime`

**ä»»å‹™**:
- [ ] åœ¨ `IStepInput.response` æ–°å¢ `body?`, `headers?`, `responseTime?`
- [ ] ä¿æŒå‘å¾Œç›¸å®¹æ€§ (æ‰€æœ‰æ–°æ¬„ä½éƒ½æ˜¯å¯é¸)
- [ ] TypeScript ç·¨è­¯é€šé

**è®Šæ›´å…§å®¹**:
```typescript
export interface IStepInput {
  name: string;
  status: 'success' | 'failure' | 'skipped';
  startTime: string;
  duration: number;
  request: {
    method: string;
    url: string;
    headers: Record<string, string>;
    body: unknown;
  };
  response: {
    statusCode: number;
    success: boolean;
    validationResults: string[];
    errorMessage?: string;
    // âœ¨ æ–°å¢
    body?: unknown;
    headers?: Record<string, string>;
    responseTime?: number;
  };
}
```

**é©—æ”¶æ¨™æº–**:
- TypeScript ç·¨è­¯é€šé
- ä¸ç ´å£ç¾æœ‰æ¸¬è©¦
- æ–°å¢çš„æ¬„ä½ç‚ºå¯é¸,ç¢ºä¿å‘å¾Œç›¸å®¹

---

#### 1.2 ä¿®æ”¹ ReportingIntegration å‚³éå®Œæ•´è³‡æ–™ (1 å°æ™‚)

**æª”æ¡ˆ**: `packages/core-flow/src/reporting-integration.ts`

**å•é¡Œ**: ç¬¬ 99-112 è¡Œ `recordStepComplete()` æ²’æœ‰å‚³é response body/headers

**ä»»å‹™**:
- [ ] ä¿®æ”¹ `recordStepComplete()` æ–¹æ³•
- [ ] å¾ `testResult.response` æå– `data`, `headers`, `duration`
- [ ] å‚³éçµ¦ `IStepInput.response`

**è®Šæ›´å…§å®¹**:
```typescript
const stepInput: IStepInput = {
  name: step.name,
  status: testResult.status === 'passed' ? 'success' :
          testResult.status === 'failed' ? 'failure' : 'skipped',
  startTime: stepStartTime,
  duration: testResult.duration,
  request,
  response: {
    statusCode: response.statusCode,
    success: testResult.status === 'passed',
    validationResults: response.validationResults,
    errorMessage: response.errorMessage || testResult.error,
    // âœ¨ æ–°å¢: å¾ testResult.response å‚³é
    body: testResult.response?.data,
    headers: testResult.response?.headers,
    responseTime: testResult.response?.duration
  }
};
```

**é©—æ”¶æ¨™æº–**:
- `IStepInput` åŒ…å«å®Œæ•´çš„ response è³‡è¨Š
- æ‰€æœ‰å‘¼å«é»éƒ½æ­£å¸¸é‹ä½œ
- æ•´åˆæ¸¬è©¦é€šé

---

#### 1.3 ä¿®æ”¹ execution-report.ts æ–°å¢ errorDetails æ¬„ä½ (30 åˆ†é˜)

**æª”æ¡ˆ**: `packages/reporting/src/execution-report.ts`

**ä»»å‹™**:
- [ ] åœ¨ `IStepResult.response` æ–°å¢ `errorDetails` æ¬„ä½
- [ ] å®šç¾© `ErrorDetails` ä»‹é¢
- [ ] ä¿æŒå‘å¾Œç›¸å®¹æ€§

**è®Šæ›´å…§å®¹**:
```typescript
/**
 * éŒ¯èª¤è©³æƒ… (å¤±æ•—æ™‚æ‰åŒ…å«)
 */
export interface IErrorDetails {
  body: unknown;                      // å®Œæ•´éŒ¯èª¤å›æ‡‰ (å·²é®ç½©æ•æ„Ÿè³‡æ–™)
  headers: Record<string, string>;    // å›æ‡‰ Headers (å·²é®ç½©æ•æ„Ÿè³‡æ–™)
  responseTime: number;               // å›æ‡‰æ™‚é–“ (æ¯«ç§’)
  bodySize: number;                   // åŸå§‹ body å¤§å°
  bodyTruncated: boolean;             // æ˜¯å¦è¢«æˆªæ–·
}

export interface IStepResult {
  // ... ç¾æœ‰æ¬„ä½
  response: {
    statusCode: number;
    success: boolean;
    bodyHash: string;

    // âœ¨ æ–°å¢: å¤±æ•—æ™‚çš„å®Œæ•´éŒ¯èª¤è³‡è¨Š
    errorDetails?: IErrorDetails;

    validationResults: string[];
    errorMessage: string | null;
  };
}
```

**é©—æ”¶æ¨™æº–**:
- TypeScript ç·¨è­¯é€šé
- ä¸ç ´å£ç¾æœ‰æ¸¬è©¦
- æ–°å¢çš„æ¬„ä½ç‚ºå¯é¸,ç¢ºä¿å‘å¾Œç›¸å®¹

---

#### 1.4 å¯¦ä½œæ•æ„Ÿè³‡æ–™é®ç½© (3 å°æ™‚)

**æª”æ¡ˆ**: `packages/reporting/src/report-generator.ts`

**ä»»å‹™**:
- [ ] å¯¦ä½œ `maskSensitiveFields()` æ–¹æ³• (éè¿´é®ç½©)
- [ ] å¯¦ä½œ `maskSensitiveHeaders()` æ–¹æ³•
- [ ] ç¢ºä¿ `stack_trace` ä¸è¢«é®ç½©
- [ ] åŠ å…¥å–®å…ƒæ¸¬è©¦

**é®ç½©è¦å‰‡**:
- **æ•æ„Ÿæ¬„ä½**: `password`, `token`, `secret`, `apiKey`, `api_key`, `authorization`, `jwt`, `bearer`, `credentials`, `access_token`
- **æ•æ„Ÿ Headers**: `authorization`, `cookie`, `set-cookie`, `x-api-key`, `x-auth-token`, `proxy-authorization`
- **ä¸é®ç½©**: `stack_trace`, `stackTrace` (è¨ºæ–·éœ€è¦)

**å¯¦ä½œ**:
```typescript
/**
 * é®ç½©æ•æ„Ÿæ¬„ä½
 */
private maskSensitiveFields(obj: unknown): unknown {
  if (typeof obj !== 'object' || obj === null) {
    return obj;
  }

  if (Array.isArray(obj)) {
    return obj.map(item => this.maskSensitiveFields(item));
  }

  const masked: any = {};
  const sensitiveKeys = [
    'password', 'token', 'secret', 'apikey', 'api_key',
    'authorization', 'jwt', 'bearer', 'credentials', 'access_token'
  ];

  for (const [key, value] of Object.entries(obj)) {
    const keyLower = key.toLowerCase();

    // stack_trace ä¸é®ç½©
    if (key === 'stack_trace' || key === 'stackTrace') {
      masked[key] = value;
      continue;
    }

    // æ•æ„Ÿæ¬„ä½é®ç½©
    if (sensitiveKeys.some(sk => keyLower.includes(sk))) {
      masked[key] = '***';
    } else {
      masked[key] = this.maskSensitiveFields(value);
    }
  }

  return masked;
}

/**
 * é®ç½©æ•æ„Ÿ Headers
 */
private maskSensitiveHeaders(headers: Record<string, string>): Record<string, string> {
  const sensitiveHeaders = [
    'authorization', 'cookie', 'set-cookie',
    'x-api-key', 'x-auth-token', 'proxy-authorization'
  ];

  const masked: Record<string, string> = {};

  for (const [key, value] of Object.entries(headers)) {
    const keyLower = key.toLowerCase();
    if (sensitiveHeaders.includes(keyLower)) {
      masked[key] = '***';
    } else {
      masked[key] = value;
    }
  }

  return masked;
}
```

**æ¸¬è©¦æ¡ˆä¾‹**:
```typescript
// æ¸¬è©¦ 1: æ•æ„Ÿæ¬„ä½é®ç½©
{
  "error": "AUTH_FAILED",
  "password": "secret123",    // â†’ "***"
  "user_id": 456              // â†’ 456 (ä¿ç•™)
}

// æ¸¬è©¦ 2: stack_trace ä¸é®ç½©
{
  "error": "SERVER_ERROR",
  "stack_trace": ["at foo()", "at bar()"],  // â†’ ä¿ç•™å®Œæ•´å…§å®¹
  "api_key": "abc123"         // â†’ "***"
}

// æ¸¬è©¦ 3: å·¢ç‹€ç‰©ä»¶é®ç½©
{
  "user": {
    "email": "user@ex.com",   // â†’ ä¿ç•™
    "password": "secret"      // â†’ "***"
  }
}
```

---

#### 1.5 ä¿®æ”¹å ±è¡¨ç”Ÿæˆé‚è¼¯ (2 å°æ™‚)

**æª”æ¡ˆ**: `packages/reporting/src/report-generator.ts`

**å•é¡Œ**: ç¬¬ 57-76 è¡Œ `generateStepResult()` éœ€è¦åœ¨å¤±æ•—æ™‚ä¿ç•™ errorDetails

**ä»»å‹™**:
- [ ] ä¿®æ”¹ `generateStepResult()` æ–¹æ³•
- [ ] å¤±æ•—æ™‚å»ºç«‹ `errorDetails` ç‰©ä»¶
- [ ] æˆåŠŸæ™‚ç¶­æŒåªå­˜ hash (ç¯€çœç©ºé–“)
- [ ] åŠ å…¥æ•´åˆæ¸¬è©¦

**é‚è¼¯**:
```typescript
private generateStepResult(stepInput: IStepInput): IStepResult {
  const isFailure = stepInput.status === 'failure';
  const responseBody = stepInput.response.body;

  return {
    name: stepInput.name,
    status: stepInput.status,
    startTime: stepInput.startTime,
    duration: stepInput.duration,
    request: {
      method: stepInput.request.method,
      url: stepInput.request.url,
      headerHash: this.calculateHash(stepInput.request.headers),
      bodyHash: this.calculateHash(stepInput.request.body),
    },
    response: {
      statusCode: stepInput.response.statusCode,
      success: stepInput.response.success,
      validationResults: stepInput.response.validationResults,
      errorMessage: stepInput.response.errorMessage || null,

      // âœ¨ å¤±æ•—æ™‚ä¿ç•™å®Œæ•´éŒ¯èª¤è³‡è¨Š
      errorDetails: isFailure && responseBody ? {
        body: this.maskSensitiveFields(responseBody),
        headers: this.maskSensitiveHeaders(stepInput.response.headers || {}),
        responseTime: stepInput.response.responseTime || 0,
        bodySize: JSON.stringify(responseBody).length,
        bodyTruncated: false // TODO: å¯¦ä½œæˆªæ–·é‚è¼¯
      } : undefined
    },
  };
}
```

**é©—æ”¶æ¨™æº–**:
- å¤±æ•—çš„æ­¥é©Ÿå ±è¡¨åŒ…å« `errorDetails`
- æˆåŠŸçš„æ­¥é©Ÿå ±è¡¨ä¸åŒ…å« `errorDetails`
- æ•æ„Ÿè³‡æ–™å·²è¢«é®ç½©
- `stack_trace` å®Œæ•´ä¿ç•™
- æ‰€æœ‰ç¾æœ‰æ¸¬è©¦é€šé

---

### éšæ®µ 2: å»ºç«‹è¨ºæ–·ä¸Šä¸‹æ–‡ç”Ÿæˆå™¨ (2 å¤©) ğŸŸ¡ é«˜å„ªå…ˆç´š

**ç›®æ¨™**: ç‚º Claude æº–å‚™çµæ§‹åŒ–ã€æ˜“ç†è§£çš„è¨ºæ–·è³‡è¨Š

**ä¿®æ­£èªªæ˜**: ç¶“éå¯¦éš›ç¨‹å¼ç¢¼åˆ†æ,éŒ¯èª¤åˆ†é¡é‚è¼¯æ¯”é æœŸç°¡å–®,å› ç‚º:
1. ç¶²è·¯éŒ¯èª¤çµ±ä¸€ç‚º `statusCode: 0`
2. å¯çµåˆ `errorDetails.body.error` æé«˜æº–ç¢ºåº¦
3. ä¸éœ€è¦è¤‡é›œçš„æ¨¡å¼è­˜åˆ¥

#### 2.1 å®šç¾©è¨ºæ–·ä¸Šä¸‹æ–‡å‹åˆ¥

**æª”æ¡ˆ**: `packages/reporting/src/diagnostic-context.ts` (æ–°å»º)

**ä»»å‹™**:
- [ ] å®šç¾© `DiagnosticContext` ä»‹é¢
- [ ] å®šç¾© `FailedStepDiagnostic` ä»‹é¢
- [ ] å®šç¾© `ErrorPattern` ä»‹é¢
- [ ] å®šç¾© `DiagnosticHints` ä»‹é¢
- [ ] åŠ å…¥å®Œæ•´çš„ JSDoc è¨»è§£

**æ ¸å¿ƒå‹åˆ¥**:
```typescript
export interface DiagnosticContext {
  hasFailed: boolean;
  failureCount: number;
  failedSteps: FailedStepDiagnostic[];
  environment: EnvironmentDiagnostic;
  errorPatterns: ErrorPattern[];
  diagnosticHints: DiagnosticHints;
  relatedSteps?: RelatedStepInfo[];
}
```

---

#### 2.2 å¯¦ä½œè¨ºæ–·ä¸Šä¸‹æ–‡å»ºæ§‹å™¨

**æª”æ¡ˆ**: `packages/reporting/src/diagnostic-context-builder.ts` (æ–°å»º)

**ä»»å‹™**:
- [ ] å¯¦ä½œ `DiagnosticContextBuilder` é¡åˆ¥
- [ ] å¯¦ä½œ `build()` æ–¹æ³• - ä¸»è¦å…¥å£
- [ ] å¯¦ä½œ `buildFailedStepDiagnostic()` - åˆ†æå–®ä¸€å¤±æ•—æ­¥é©Ÿ
- [ ] å¯¦ä½œ `classifyError()` - è‡ªå‹•åˆ†é¡éŒ¯èª¤é¡å‹
- [ ] å¯¦ä½œ `detectErrorPatterns()` - åµæ¸¬éŒ¯èª¤æ¨¡å¼
- [ ] å¯¦ä½œ `generateDiagnosticHints()` - ç”Ÿæˆè¨ºæ–·æç¤º
- [ ] åŠ å…¥å®Œæ•´å–®å…ƒæ¸¬è©¦

**é—œéµæ–¹æ³•**:
```typescript
export class DiagnosticContextBuilder {
  build(report: IExecutionReport): DiagnosticContext | null;

  private buildFailedStepDiagnostic(step: IStepResult): FailedStepDiagnostic;
  private classifyError(step: IStepResult): ErrorClassification;
  private detectErrorPatterns(report: IExecutionReport): ErrorPattern[];
  private generateDiagnosticHints(failedSteps: IStepResult[]): DiagnosticHints;
}
```

**éŒ¯èª¤åˆ†é¡é‚è¼¯** (æ”¹é€²ç‰ˆ):
```typescript
private classifyError(step: IStepResult): ErrorClassification {
  const code = step.response.statusCode;
  const body = step.response.errorDetails?.body;
  const errorCode = typeof body === 'object' && body !== null ?
    (body as any).error : null;

  // ç¶²è·¯å±¤ç´šéŒ¯èª¤ (ç”± HttpClient çµ±ä¸€è™•ç†)
  if (code === 0) {
    return { primaryType: 'network', confidence: 95, indicators: ['statusCode: 0'] };
  }

  // èªè­‰éŒ¯èª¤ (çµåˆéŒ¯èª¤ä»£ç¢¼æé«˜æº–ç¢ºåº¦)
  if (code === 401) {
    const authCodes = ['TOKEN_EXPIRED', 'AUTHENTICATION_FAILED', 'INVALID_TOKEN'];
    if (errorCode && authCodes.includes(errorCode)) {
      return { primaryType: 'auth', confidence: 95, indicators: [`HTTP 401`, `error: ${errorCode}`] };
    }
    return { primaryType: 'auth', confidence: 80, indicators: ['HTTP 401'] };
  }

  // æˆæ¬ŠéŒ¯èª¤
  if (code === 403) {
    return { primaryType: 'auth', confidence: 85, indicators: ['HTTP 403'] };
  }

  // é©—è­‰éŒ¯èª¤
  if (code === 400 || code === 422) {
    return { primaryType: 'validation', confidence: 85, indicators: [`HTTP ${code}`] };
  }

  // ä¼ºæœå™¨éŒ¯èª¤
  if (code >= 500) {
    return { primaryType: 'server', confidence: 90, indicators: [`HTTP ${code}`] };
  }

  return { primaryType: 'unknown', confidence: 50, indicators: [`HTTP ${code}`] };
}
```

**éŒ¯èª¤æ¨¡å¼åµæ¸¬**:
- é€£çºŒèªè­‰å¤±æ•—
- ç¬¬ä¸€æ­¥å¤±æ•—å°è‡´é€£é–å¤±æ•—
- å…¨éƒ¨ç¶²è·¯éŒ¯èª¤ (API æœªå•Ÿå‹•)

---

#### 2.3 å¯¦ä½œè¨ºæ–·æç¤ºç”Ÿæˆå™¨

**æª”æ¡ˆ**: `packages/reporting/src/diagnostic-hints-generator.ts` (æ–°å»º)

**ä»»å‹™**:
- [ ] å¯¦ä½œå¿«é€Ÿè¨ºæ–·ç”Ÿæˆ
- [ ] å¯¦ä½œå¯èƒ½åŸå› åˆ†æ
- [ ] å¯¦ä½œä¿®å¾©å»ºè­°ç”Ÿæˆ
- [ ] åŠ å…¥å–®å…ƒæ¸¬è©¦

**ç¯„ä¾‹è¼¸å‡º**:
```typescript
{
  quickDiagnosis: "2 å€‹æ­¥é©Ÿå¤±æ•—,ä¸»è¦æ˜¯èªè­‰å•é¡Œ",
  likelyCauses: [
    "èªè­‰ Token éºå¤±ã€ç„¡æ•ˆæˆ–å·²éæœŸ",
    "API Key è¨­å®šéŒ¯èª¤"
  ],
  suggestedActions: [
    "æ›´æ–°æˆ–é‡æ–°å–å¾—èªè­‰ Token",
    "æª¢æŸ¥ .env.local ä¸­çš„ SPEC_PILOT_TOKEN"
  ]
}
```

---

### éšæ®µ 3: æ•´åˆè¨ºæ–·ä¸Šä¸‹æ–‡åˆ° MCP (1-2 å¤©) ğŸŸ¡ é«˜å„ªå…ˆç´š

**ç›®æ¨™**: è®“ getReport å›å‚³åŒ…å«è¨ºæ–·ä¸Šä¸‹æ–‡çš„å ±è¡¨

#### 3.1 ä¿®æ”¹ MCP getReport Handler

**æª”æ¡ˆ**: `apps/mcp-server/src/handlers/get-report.ts`

**ä»»å‹™**:
- [ ] å¼•å…¥ `DiagnosticContextBuilder`
- [ ] åœ¨å›å‚³å ±è¡¨å‰å»ºç«‹è¨ºæ–·ä¸Šä¸‹æ–‡
- [ ] å°‡è¨ºæ–·ä¸Šä¸‹æ–‡åŠ å…¥å›æ‡‰
- [ ] æ›´æ–°å›æ‡‰å‹åˆ¥å®šç¾©
- [ ] åŠ å…¥æ•´åˆæ¸¬è©¦

**è®Šæ›´**:
```typescript
import { DiagnosticContextBuilder } from '@specpilot/reporting';

export function handleGetReport(request: IMcpRequest): IMcpResponse {
  // ... ç¾æœ‰é‚è¼¯ ...

  const report = parsedReport as IExecutionReport;

  // âœ¨ å»ºç«‹è¨ºæ–·ä¸Šä¸‹æ–‡
  const diagnosticBuilder = new DiagnosticContextBuilder();
  const diagnosticContext = diagnosticBuilder.build(report);

  const result: IGetReportResult = {
    reportPath,
    executionId: report.executionId,
    status: report.status,
    reportSummary: { ... },
    report,
    diagnosticContext,  // âœ¨ æ–°å¢è¨ºæ–·ä¸Šä¸‹æ–‡
  };

  return createSuccessResponse(result, requestId);
}
```

---

#### 3.2 æ›´æ–° MCP å›æ‡‰å‹åˆ¥

**æª”æ¡ˆ**: `apps/mcp-server/src/rpc-handler.ts`

**ä»»å‹™**:
- [ ] åœ¨ `IGetReportResult` æ–°å¢ `diagnosticContext` æ¬„ä½
- [ ] æ›´æ–°å‹åˆ¥å®šç¾©
- [ ] ç¢ºä¿ TypeScript ç·¨è­¯é€šé

**è®Šæ›´**:
```typescript
export interface IGetReportResult {
  reportPath: string;
  executionId: string;
  status: string;
  reportSummary: {
    totalSteps: number;
    successfulSteps: number;
    failedSteps: number;
    skippedSteps: number;
    duration: number;
  };
  report: IExecutionReport;
  diagnosticContext?: DiagnosticContext;  // âœ¨ æ–°å¢
}
```

---

### éšæ®µ 4: API é–‹ç™¼è¦ç¯„ (å·²å®Œæˆ) âœ…

**ç‹€æ…‹**: å·²æœ‰å®Œæ•´æ–‡ä»¶,ç„¡éœ€é¡å¤–é–‹ç™¼

#### 4.1 ç¾æœ‰æ–‡ä»¶

**æª”æ¡ˆ**: `docs/guides/api-errors/api-error-handling-guide.md` âœ…

**å·²åŒ…å«å…§å®¹**:
- âœ… æ¨™æº–éŒ¯èª¤æ ¼å¼è¦ç¯„ (JSON Schema)
- âœ… å››ç¨®ä¸»æµæ¡†æ¶å¯¦ä½œç¯„ä¾‹ (Node.js, Python, Java, .NET)
- âœ… Stack Trace è™•ç†è¦ç¯„èˆ‡ç’°å¢ƒåˆ†é›¢ç­–ç•¥
- âœ… å¸¸è¦‹éŒ¯èª¤é¡å‹ç¯„ä¾‹ (401, 403, 422, 404, 500, 502)
- âœ… OpenAPI Schema å®šç¾©
- âœ… SpecPilot æ•´åˆæ­¥é©Ÿ
- âœ… å®‰å…¨æ€§æ³¨æ„äº‹é …èˆ‡æ¸¬è©¦æª¢æŸ¥æ¸…å–®
- âœ… å®Œæ•´å·¥ä½œæµç¨‹åœ– (é–‹ç™¼ã€æ¸¬è©¦ã€AI è¨ºæ–·)

**é—œéµç‰¹é»**:
1. **å››ç¨®æ¡†æ¶æ”¯æ´**: Node.js (Express), Python (FastAPI/Flask), Java (Spring Boot), .NET (ASP.NET Core)
2. **ç’°å¢ƒåˆ†é›¢**: Development (å®Œæ•´ stack trace) / Staging (ç²¾ç°¡) / Production (éš±è—)
3. **æ•æ„Ÿè³‡æ–™é®ç½©**: è‡ªå‹•é®ç½© password, token, secret ç­‰æ¬„ä½
4. **æ¨™æº–åŒ–éŒ¯èª¤ä»£ç¢¼**: å¤§å¯«è›‡å½¢å‘½å (å¦‚ `AUTHENTICATION_FAILED`)
5. **è¨ºæ–·æç¤ºæ¬„ä½**: `hint` æä¾›å¿«é€Ÿä¿®å¾©å»ºè­°

---

#### 4.2 åƒè€ƒç¯„ä¾‹

**æ¨™æº–éŒ¯èª¤æ ¼å¼**:
```json
{
  "error": "AUTHENTICATION_FAILED",
  "message": "JWT Token å·²éæœŸ",
  "hint": "è«‹ä½¿ç”¨ /auth/refresh ç«¯é»æ›´æ–° Token",
  "stack_trace": [
    "at AuthService.verifyToken (auth-service.js:45)",
    "at AuthMiddleware.authenticate (auth-middleware.js:23)"
  ],
  "source_context": {
    "file": "auth-service.js",
    "line": 45,
    "method": "verifyToken"
  },
  "request_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2025-01-15T10:30:45.123Z",
  "status_code": 401,
  "path": "/api/users/profile"
}
```

**OpenAPI Schema** (å·²åŒ…å«åœ¨æ–‡ä»¶ä¸­):
- å®Œæ•´çš„ `DiagnosticError` Schema å®šç¾©
- èˆ‡ SpecPilot æ•´åˆç¯„ä¾‹
- æ¸¬è©¦æµç¨‹ YAML ç¯„ä¾‹

---

#### 4.3 å¾ŒçºŒå·¥ä½œ

**ç„¡éœ€é¡å¤–é–‹ç™¼**,ä½†å¯ä»¥åœ¨å¯¦ä½œå®Œæˆå¾Œ:
- [ ] æ›´æ–°æ–‡ä»¶é€£çµåˆ°å¯¦éš›çš„è¨ºæ–·åŠŸèƒ½æ–‡ä»¶
- [ ] åœ¨ README.md ä¸­åŠ å…¥ API é–‹ç™¼è¦ç¯„çš„åƒè€ƒé€£çµ
- [ ] æ ¹æ“šå¯¦éš›æ¸¬è©¦çµæœæ›´æ–°è¨ºæ–·æˆåŠŸç‡æ•¸æ“š

**æ™‚é–“**: **0 å¤©** (å·²å®Œæˆ)

---

### éšæ®µ 5: æ¸¬è©¦èˆ‡é©—è­‰ (2-3 å¤©) ğŸŸ¡ é«˜å„ªå…ˆç´š

#### 5.1 å–®å…ƒæ¸¬è©¦

**ä»»å‹™**:
- [ ] `report-generator.test.ts` - æ¸¬è©¦æ•æ„Ÿè³‡æ–™é®ç½©
- [ ] `diagnostic-context-builder.test.ts` - æ¸¬è©¦è¨ºæ–·ä¸Šä¸‹æ–‡ç”Ÿæˆ
- [ ] `diagnostic-hints-generator.test.ts` - æ¸¬è©¦æç¤ºç”Ÿæˆ
- [ ] æ¸¬è©¦è¦†è“‹ç‡ â‰¥ 80%

**æ¸¬è©¦æ¡ˆä¾‹**:
- æˆåŠŸçš„æ¸¬è©¦ä¸æ‡‰åŒ…å« errorDetails
- å¤±æ•—çš„æ¸¬è©¦æ‡‰åŒ…å«å®Œæ•´ errorDetails
- æ•æ„Ÿæ¬„ä½è¢«æ­£ç¢ºé®ç½©
- éŒ¯èª¤åˆ†é¡æ­£ç¢º (auth, network, validation, server)
- éŒ¯èª¤æ¨¡å¼åµæ¸¬æ­£ç¢º
- è¨ºæ–·æç¤ºåˆç†ä¸”æœ‰ç”¨

---

#### 5.2 æ•´åˆæ¸¬è©¦

**æª”æ¡ˆ**: `apps/mcp-server/__tests__/get-report-with-diagnosis.test.ts` (æ–°å»º)

**ä»»å‹™**:
- [ ] æ¸¬è©¦å®Œæ•´çš„ getReport æµç¨‹
- [ ] é©—è­‰è¨ºæ–·ä¸Šä¸‹æ–‡æ­£ç¢ºç”Ÿæˆ
- [ ] æ¸¬è©¦å„ç¨®å¤±æ•—å ´æ™¯
- [ ] æ¸¬è©¦ MCP å›æ‡‰æ ¼å¼

**æ¸¬è©¦å ´æ™¯**:
1. èªè­‰å¤±æ•— (401) - æ‡‰åˆ†é¡ç‚º auth
2. ç¶²è·¯éŒ¯èª¤ (statusCode: 0) - æ‡‰åˆ†é¡ç‚º network
3. ä¼ºæœå™¨éŒ¯èª¤ (500) - æ‡‰åˆ†é¡ç‚º server
4. Schema é©—è­‰å¤±æ•— - æ‡‰åˆ†é¡ç‚º validation
5. æ··åˆå¤±æ•— - æ‡‰åµæ¸¬éŒ¯èª¤æ¨¡å¼

---

#### 5.3 ç«¯å°ç«¯æ¸¬è©¦

**ä»»å‹™**:
- [ ] å»ºç«‹æ¸¬è©¦ API (åŒ…å«è¨ºæ–·å‹å–„çš„éŒ¯èª¤æ ¼å¼)
- [ ] åŸ·è¡Œå®Œæ•´æ¸¬è©¦æµç¨‹
- [ ] é©—è­‰å ±è¡¨åŒ…å«è¨ºæ–·ä¸Šä¸‹æ–‡
- [ ] åœ¨ Claude Desktop ä¸­æ‰‹å‹•æ¸¬è©¦è¨ºæ–·åŠŸèƒ½

**æ¸¬è©¦æµç¨‹**:
1. å•Ÿå‹•æ¸¬è©¦ API
2. åŸ·è¡Œæœƒå¤±æ•—çš„æ¸¬è©¦ Flow
3. æª¢æŸ¥ç”Ÿæˆçš„å ±è¡¨æ˜¯å¦åŒ…å« `errorDetails`
4. ä½¿ç”¨ MCP çš„ `getReport` å–å¾—å ±è¡¨
5. é©—è­‰ `diagnosticContext` çš„å…§å®¹
6. åœ¨ Claude Desktop ä¸­è©¢å•å¤±æ•—åŸå› 
7. é©—è­‰ Claude èƒ½å¤ ç†è§£ä¸¦çµ¦å‡ºè¨ºæ–·

---

### éšæ®µ 6: æ–‡ä»¶èˆ‡ç¯„ä¾‹ (1-2 å¤©) ğŸŸ¢ ä¸­å„ªå…ˆç´š

#### 6.1 æ›´æ–°å°ˆæ¡ˆæ–‡ä»¶

**ä»»å‹™**:
- [ ] æ›´æ–° `README.md` - èªªæ˜è¨ºæ–·åŠŸèƒ½
- [ ] æ›´æ–° `MCP-SETUP.md` - åŠ å…¥è¨ºæ–·åŠŸèƒ½ä½¿ç”¨èªªæ˜
- [ ] å»ºç«‹ `docs/diagnosis-feature.md` - å®Œæ•´åŠŸèƒ½èªªæ˜

---

#### 6.2 å»ºç«‹ä½¿ç”¨ç¯„ä¾‹

**æª”æ¡ˆ**: `examples/diagnosis-workflow/` (æ–°å»º)

**ä»»å‹™**:
- [ ] å»ºç«‹ç¯„ä¾‹ API (å«è¨ºæ–·å‹å–„éŒ¯èª¤æ ¼å¼)
- [ ] å»ºç«‹æ¸¬è©¦ Flow (åŒ…å«æœƒå¤±æ•—çš„æ¸¬è©¦)
- [ ] å»ºç«‹ä½¿ç”¨èªªæ˜ `README.md`
- [ ] æä¾› Claude Desktop äº’å‹•ç¯„ä¾‹

**ç¯„ä¾‹å…§å®¹**:
```
examples/diagnosis-workflow/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ server.js              # æ¸¬è©¦ API ä¼ºæœå™¨
â”‚   â””â”€â”€ error-handler.js       # è¨ºæ–·å‹å–„çš„éŒ¯èª¤è™•ç†
â”œâ”€â”€ specs/
â”‚   â””â”€â”€ test-api.yaml          # OpenAPI è¦æ ¼
â”œâ”€â”€ flows/
â”‚   â””â”€â”€ failing-tests.yaml     # æœƒå¤±æ•—çš„æ¸¬è©¦
â””â”€â”€ README.md                  # ä½¿ç”¨èªªæ˜
```

---

#### 6.3 å»ºç«‹ç–‘é›£æ’è§£æŒ‡å—

**æª”æ¡ˆ**: `docs/diagnosis-troubleshooting.md` (æ–°å»º)

**ä»»å‹™**:
- [ ] å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ
- [ ] è¨ºæ–·çµæœä¸æº–ç¢ºæ™‚çš„è™•ç†
- [ ] å¦‚ä½•æ”¹å–„éŒ¯èª¤è¨Šæ¯å“è³ª

---

## ğŸ“Š é–‹ç™¼æ™‚ç¨‹ä¼°ç®—

### ä¿®æ­£å‰ vs ä¿®æ­£å¾Œ

| éšæ®µ | åŸä¼°è¨ˆ | ä¿®æ­£å¾Œ | è®ŠåŒ– | å„ªå…ˆç´š | ä¾è³´ |
|-----|-------|-------|------|-------|-----|
| éšæ®µ 1: å¢å¼·éŒ¯èª¤å ±è¡¨ | 2-3 å¤© | **2.5 å¤©** | -0.5å¤© | ğŸ”´ æœ€é«˜ | ç„¡ |
| éšæ®µ 2: è¨ºæ–·ä¸Šä¸‹æ–‡ç”Ÿæˆå™¨ | 2-3 å¤© | **2 å¤©** | -1å¤© | ğŸŸ¡ é«˜ | éšæ®µ 1 |
| éšæ®µ 3: æ•´åˆåˆ° MCP | 1-2 å¤© | **1 å¤©** | -1å¤© | ğŸŸ¡ é«˜ | éšæ®µ 2 |
| éšæ®µ 4: API é–‹ç™¼è¦ç¯„ | 1 å¤© | **0 å¤©** | -1å¤© (å·²æœ‰æ–‡ä»¶) | ğŸŸ¢ ä¸­ | å¯ä¸¦è¡Œ |
| éšæ®µ 5: æ¸¬è©¦èˆ‡é©—è­‰ | 2-3 å¤© | **4 å¤©** | +1.5å¤© | ğŸŸ¡ é«˜ | éšæ®µ 1-3 |
| éšæ®µ 6: æ–‡ä»¶èˆ‡ç¯„ä¾‹ | 1-2 å¤© | **1.5 å¤©** | -0.5å¤© | ğŸŸ¢ ä¸­ | éšæ®µ 5 |
| **ç¸½è¨ˆ** | **9-14 å¤©** | **11 å¤©** | **-3å¤©** | | |

### ä¿®æ­£ç†ç”±

**æ¸›å°‘çš„å·¥ä½œé‡**:
1. âœ… è³‡æ–™æµç¨‹å·²æ¸…æ¥š,ä¸éœ€è¦æ¶æ§‹é‡æ§‹ (-1å¤©)
2. âœ… Axios å·²è™•ç† JSON è§£æ (-0.5å¤©)
3. âœ… å·²æœ‰ `api-error-handling-guide.md` (-1å¤©)
4. âœ… Stack trace ä¸éœ€è¦æå–é‚è¼¯ (-0.5å¤©)

**å¢åŠ çš„å·¥ä½œé‡**:
1. âš ï¸ æ¸¬è©¦è¦†è“‹ç‡éœ€è¦æ›´å®Œæ•´ (+1.5å¤©)
2. âš ï¸ ç¶²è·¯éŒ¯èª¤è™•ç†éœ€è¦ä¿®æ”¹ç¾æœ‰é‚è¼¯ (+0.5å¤©)

---

## ğŸ¯ é‡Œç¨‹ç¢‘

### Milestone 1: åŸºç¤åŠŸèƒ½å®Œæˆ (ç¬¬ 1-4.5 å¤©)
- âœ… ç¶²è·¯éŒ¯èª¤è™•ç†ä¿®å¾© (HttpClient)
- âœ… å‹åˆ¥å®šç¾©æ“´å…… (IStepInput, IErrorDetails)
- âœ… å ±è¡¨åŒ…å«å®Œæ•´éŒ¯èª¤è³‡è¨Š
- âœ… æ•æ„Ÿè³‡æ–™æ­£ç¢ºé®ç½©
- âœ… è¨ºæ–·ä¸Šä¸‹æ–‡æ­£ç¢ºç”Ÿæˆ
- âœ… MCP getReport å›å‚³è¨ºæ–·ä¸Šä¸‹æ–‡

**é©—æ”¶æ¨™æº–**:
- æ‰€æœ‰å–®å…ƒæ¸¬è©¦é€šé
- ç¶²è·¯éŒ¯èª¤ä¸æœƒä¸­æ–·æ¸¬è©¦æµç¨‹
- å¯ä»¥åœ¨å ±è¡¨ä¸­çœ‹åˆ°å®Œæ•´éŒ¯èª¤è¨Šæ¯ (åŒ…å« stack_trace)
- æ•æ„Ÿè³‡æ–™å·²é®ç½© (å¯†ç¢¼ã€Token ç­‰é¡¯ç¤ºç‚º ***)
- Claude Desktop èƒ½è®€å–åˆ°è¨ºæ–·ä¸Šä¸‹æ–‡

**å¯¦éš›å·¥ä½œåˆ†è§£**:
- ç¬¬ 1 å¤©: 1.0 + 1.1 (ç¶²è·¯éŒ¯èª¤ + å‹åˆ¥æ“´å……)
- ç¬¬ 2 å¤©: 1.2 + 1.3 (è³‡æ–™å‚³é + errorDetails)
- ç¬¬ 3 å¤©: 1.4 + 1.5 (æ•æ„Ÿè³‡æ–™é®ç½© + å ±è¡¨é‚è¼¯)
- ç¬¬ 4-4.5 å¤©: éšæ®µ 2 è¨ºæ–·ä¸Šä¸‹æ–‡

---

### Milestone 2: å®Œæ•´æ¸¬è©¦é€šé (ç¬¬ 5.5-9.5 å¤©)
- âœ… æ‰€æœ‰æ¸¬è©¦é€šé (è¦†è“‹ç‡ â‰¥ 80%)
- âœ… æ•´åˆæ¸¬è©¦é©—è­‰å„ç¨®éŒ¯èª¤å ´æ™¯
- âœ… ç«¯å°ç«¯æ¸¬è©¦ç¢ºèªå¯¦éš›æ•ˆæœ

**é©—æ”¶æ¨™æº–**:
- CI/CD å…¨ç¶ 
- åœ¨ Claude Desktop ä¸­å¯¦éš›æ¸¬è©¦è¨ºæ–·åŠŸèƒ½
- Claude èƒ½æ­£ç¢ºè¨ºæ–·è‡³å°‘ 6 ç¨®éŒ¯èª¤é¡å‹:
  1. ç¶²è·¯éŒ¯èª¤ (statusCode: 0)
  2. èªè­‰å¤±æ•— (401)
  3. æˆæ¬Šå¤±æ•— (403)
  4. é©—è­‰éŒ¯èª¤ (400/422)
  5. ä¼ºæœå™¨éŒ¯èª¤ (500+)
  6. é€£é–å¤±æ•—æ¨¡å¼

**å¯¦éš›å·¥ä½œåˆ†è§£**:
- ç¬¬ 5.5 å¤©: éšæ®µ 3 MCP æ•´åˆ
- ç¬¬ 6.5-9.5 å¤©: éšæ®µ 5 æ¸¬è©¦ (å–®å…ƒ + æ•´åˆ + E2E)

---

### Milestone 3: æ­£å¼ç™¼å¸ƒ (ç¬¬ 10-11 å¤©)
- âœ… å®Œæ•´æ–‡ä»¶æ›´æ–°
- âœ… ä½¿ç”¨ç¯„ä¾‹èˆ‡ç–‘é›£æ’è§£æŒ‡å—
- âœ… å¯¦éš›è¨ºæ–·æˆåŠŸç‡é©—è­‰

**é©—æ”¶æ¨™æº–**:
- æ–‡ä»¶å®Œæ•´ä¸”æ˜“æ–¼ç†è§£
- æä¾›å¯åŸ·è¡Œçš„ç¯„ä¾‹ (åŒ…å«æœƒå¤±æ•—çš„æ¸¬è©¦)
- è¨ºæ–·æˆåŠŸç‡é” **70-80%** (å¯¦éš›å¯é”æˆçš„ç›®æ¨™)
- README æ›´æ–°è¨ºæ–·åŠŸèƒ½èªªæ˜

**å¯¦éš›å·¥ä½œåˆ†è§£**:
- ç¬¬ 10-11 å¤©: éšæ®µ 6 æ–‡ä»¶èˆ‡ç¯„ä¾‹

**ğŸ“ å‚™è¨»**: è¨ºæ–·æˆåŠŸç‡å¾ 85-90% èª¿æ•´ç‚º 70-80%,å› ç‚ºå¯¦éš›ä¸Š:
- éœ€è¦ API éµå®ˆ `api-error-handling-guide.md` è¦ç¯„æ‰èƒ½é”åˆ°æœ€ä½³æ•ˆæœ
- è¨±å¤šç¾æœ‰ API ä¸æœƒæä¾›çµæ§‹åŒ–éŒ¯èª¤æˆ– stack trace
- 70-80% æ˜¯æ›´å‹™å¯¦çš„ç›®æ¨™

---

## ğŸ”§ é–‹ç™¼ç’°å¢ƒæº–å‚™

### å¿…è¦å·¥å…·
- Node.js 20.11.1 LTS
- pnpm 9.1
- TypeScript 5.4.5
- Claude Desktop (ç”¨æ–¼æ¸¬è©¦)

### å°ˆæ¡ˆè¨­å®š
```bash
# å®‰è£ä¾è³´
pnpm install

# åŸ·è¡Œæ¸¬è©¦
pnpm run test

# å•Ÿå‹• MCP Server
pnpm run start:mcp

# åŸ·è¡Œ Lint
pnpm run lint
```

---

## ğŸ“ Checklist

### é–‹ç™¼å‰æº–å‚™
- [ ] é–±è®€å®Œæ•´è¨ˆåŠƒæ–‡ä»¶
- [ ] ç¢ºèªé–‹ç™¼ç’°å¢ƒæ­£å¸¸
- [ ] å»ºç«‹åŠŸèƒ½åˆ†æ”¯ `feature/ai-diagnosis`
- [ ] è¨­å®š Git pre-commit hook

### æ¯å€‹éšæ®µå®Œæˆå¾Œ
- [ ] åŸ·è¡Œå–®å…ƒæ¸¬è©¦
- [ ] åŸ·è¡Œ Lint æª¢æŸ¥
- [ ] æ›´æ–°ç›¸é—œæ–‡ä»¶
- [ ] Commit è®Šæ›´ (éµå¾ª Conventional Commits)
- [ ] æ›´æ–°æ­¤è¨ˆåŠƒæ–‡ä»¶çš„é€²åº¦

### æœ€çµ‚ç™¼å¸ƒå‰
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] æ–‡ä»¶å®Œæ•´
- [ ] åœ¨ Claude Desktop å¯¦æ¸¬æˆåŠŸ
- [ ] Code Review
- [ ] åˆä½µåˆ° main åˆ†æ”¯
- [ ] å»ºç«‹ Release Notes

---

## ğŸš€ ä¸‹ä¸€æ­¥

å»ºè­°å¾ **éšæ®µ 1.1** é–‹å§‹:ä¿®æ”¹å ±è¡¨è³‡æ–™çµæ§‹ã€‚

æº–å‚™å¥½é–‹å§‹äº†å—? ğŸ¯
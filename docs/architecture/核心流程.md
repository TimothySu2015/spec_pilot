# 核心流程
```mermaid
sequenceDiagram
    autonumber
    actor User
    participant CLI as CLI Interface
    participant Config as Config Service
    participant Orchestrator as Flow Orchestrator
    participant SpecLoader as Spec Loader
    participant FlowParser as Flow Parser
    participant Context as Run Context
    participant Http as HTTP Execution Engine
    participant Validator as Validation Engine
    participant Reporter as Reporter
    participant Logger as Structured Logger
    participant FS as File System

    User->>CLI: specpilot run --spec openapi.yaml --flow user_crud.yaml
    CLI->>Config: 讀取 baseUrl/port/token
    Config-->>CLI: 回傳設定
    CLI->>Orchestrator: execute(specRef, flowRef, options)
    Orchestrator->>SpecLoader: 載入並驗證 OpenAPI
    SpecLoader-->>Orchestrator: 回傳 SpecDocument
    Orchestrator->>FlowParser: 載入 flow.yaml
    FlowParser-->>Orchestrator: 回傳 FlowDefinition
    Orchestrator->>Context: 建立 RunContext
    loop 每個 FlowStep
        Orchestrator->>Logger: 記錄 step 開始
        Orchestrator->>Http: 建立 HTTP 請求
        loop Retry/backoff
            Http->>Target API: 發送 HTTP 請求
            alt 連線失敗/逾時
                Http-->>Logger: 記錄 retry 與錯誤
                Http-->>Orchestrator: 回傳可重試訊息
            else 成功回應
                Http-->>Orchestrator: 回傳 Response
                break
            end
        end
        Orchestrator->>Validator: 驗證狀態碼/Schema/Custom
        alt 驗證成功
            Validator-->>Orchestrator: OK
        else 驗證失敗
            Validator-->>Orchestrator: 錯誤細節
            Orchestrator->>Logger: 記錄失敗
        end
        Orchestrator->>Reporter: 累積 StepResult
    end
    Orchestrator->>Reporter: 生成 ExecutionReport
    Reporter->>FS: 寫入 reports/result.json
    Reporter->>Logger: 記錄報告位置
    Orchestrator-->>CLI: 回傳狀態與報告路徑
    alt 任一步驟失敗
        CLI->>User: 顯示失敗摘要與報告路徑
        CLI-->>User: 非零退出碼
    else 全部成功
        CLI->>User: 顯示成功訊息
        CLI-->>User: 退出碼 0
    end
```

# SpecPilot 文件管理指南

> **目標**: 確保 AI 輔助開發時，文件與程式碼保持同步，避免產生不一致的實作

---

## 📋 文件架構原則

### 唯一真相來源 (Single Source of Truth)

```
程式碼 > Package CLAUDE.md > 根目錄 CLAUDE.md > 其他文件
```

**優先順序規則:**
1. 🥇 **程式碼是最終真相** - 有衝突時以實際程式碼為準
2. 🥈 **Package CLAUDE.md** - 描述模組的實際狀態
3. 🥉 **根目錄 CLAUDE.md** - 專案整體指導方針
4. 📄 **其他文件** - 歷史記錄、計畫、教學

---

## 📁 文件分類與用途

### 第 1 層：根目錄文件 (專案層級)

| 檔案 | 用途 | 更新頻率 | 負責維護 |
|------|------|---------|---------|
| `CLAUDE.md` | AI 的主要指導方針 | 重大變更時 | 專案負責人 |
| `README.md` | 給人類的專案介紹 | 發布新版本時 | 專案負責人 |
| `ARCHITECTURE.md` | 高階架構說明 | 架構變更時 | 架構師 |

**CLAUDE.md 內容規範:**
- ✅ **應包含**: 專案概述、技術堆疊、開發指令、核心工作流程、程式碼規範
- ❌ **不應包含**: 詳細 API 文件、實作細節、待辦事項

### 第 2 層：Package 文件 (模組層級)

| 檔案 | 用途 | 更新頻率 | 負責維護 |
|------|------|---------|---------|
| `packages/*/CLAUDE.md` | 模組實作狀態 + API 文件 | 每次程式碼變更後 | 開發者 |
| `packages/*/README.md` | 模組使用說明 | 公開 API 變更時 | 開發者 |

**Package CLAUDE.md 必須包含:**
```markdown
# @specpilot/[package-name]

## ⚠️ 實作狀態 (必填!)
**版本**: x.x.x
**完成度**: xx%
**最後更新**: YYYY-MM-DD

## 已實作功能 ✅
- [列出已完成的功能]

## 部分實作 ⚠️
- [列出進行中的功能]

## 未實作功能 ❌
- [列出計畫但未實作的功能]

## 核心職責
[實際程式碼提供的功能]

## API 使用範例
[真實可執行的範例程式碼]
```

### 第 3 層：Docs 目錄 (歷史與計畫)

```
docs/
├── guides/              # 使用手冊 (給使用者)
├── plans/              # 進行中的實作計畫
│   └── ACTIVE.md       # 當前唯一的實作計畫
├── archive/            # 已完成或過時的文件
│   ├── plans/          # 歷史實作計畫
│   └── deprecated/     # 過時文件
└── architecture/       # 架構設計文件
```

**計畫文件規範:**
- 同時只能有 **一個** `docs/plans/ACTIVE.md`
- 完成後移到 `docs/archive/plans/[name]-YYYY-MM-DD.md`
- 計畫文件開頭必須標註: **狀態: [規劃中|進行中|已完成|已取消]**

---

## 🔄 文件更新工作流程

### 情境 1: 新增功能 (AI 輔助開發)

```
1. 開發者在 docs/plans/ACTIVE.md 中規劃功能
   └─> 明確標註 [狀態: 規劃中]

2. AI 根據計畫開始實作
   └─> 更新計畫狀態為 [狀態: 進行中]

3. 實作完成後 (必須執行):
   a. 更新 packages/*/CLAUDE.md 的實作狀態
   b. 執行測試確認功能可用
   c. 更新計畫文件狀態為 [狀態: 已完成]
   d. 將計畫文件移到 docs/archive/plans/

4. 重大功能完成時更新根目錄 CLAUDE.md
```

### 情境 2: 修改現有功能

```
1. AI 讀取 packages/*/CLAUDE.md 了解當前狀態
2. 修改程式碼
3. **立即更新** packages/*/CLAUDE.md
   └─> 同步修改「已實作功能」清單
```

### 情境 3: 發現文件與程式碼不一致

```
優先順序: 程式碼 > 文件

1. 檢查程式碼實際行為
2. 更新 Package CLAUDE.md 以符合程式碼
3. 在 git commit message 註明: "docs: 同步文件與實作"
```

---

## 🤖 給 AI 的明確指令

### 開始新任務時必須執行:

```markdown
1. 讀取 /CLAUDE.md 了解專案整體規範
2. 讀取 packages/[target]/CLAUDE.md 了解模組實作狀態
3. 如果發現 CLAUDE.md 與程式碼不一致:
   → 以程式碼為準，提醒使用者更新文件
4. 不要參考 docs/plans/ 中的計畫文件來判斷實作狀態
```

### 完成實作後必須執行:

```markdown
1. 更新 packages/[target]/CLAUDE.md:
   - 將新功能加到「已實作功能 ✅」
   - 更新「完成度」百分比
   - 更新「最後更新」日期

2. 如果是重大功能，提醒使用者更新根目錄 CLAUDE.md

3. 執行測試驗證功能可用:
   pnpm -w run test packages/[target]/__tests__/ --run
```

### 產生新功能時禁止:

❌ **絕對不要**直接複製 `docs/plans/` 中的範例程式碼到 CLAUDE.md
❌ **絕對不要**假設計畫文件中的功能已經實作
✅ **必須**實際檢查程式碼檔案來確認功能存在

---

## 📋 文件品質檢查清單

### Package CLAUDE.md 檢查清單

- [ ] 是否標註了「實作狀態」區塊？
- [ ] 完成度百分比是否合理？
- [ ] 「已實作功能」是否都有對應的程式碼？
- [ ] 「未實作功能」是否清楚標註？
- [ ] 範例程式碼是否可實際執行？
- [ ] 是否有標註最後更新日期？

### 根目錄 CLAUDE.md 檢查清單

- [ ] 專案結構是否與實際 packages/ 一致？
- [ ] 主要功能描述是否準確？
- [ ] MCP 工具列表是否完整？
- [ ] 開發指令是否可執行？

---

## 🛠️ 實用工具腳本

### 驗證文件與程式碼一致性

```bash
# 檢查所有 Package 是否都有 CLAUDE.md
node scripts/check-doc-consistency.js

# 產生文件更新報告
node scripts/generate-doc-status.js
```

---

## 📌 快速參考

### 文件更新優先順序矩陣

| 變更類型 | 更新 Package CLAUDE.md | 更新根 CLAUDE.md | 更新計畫文件 |
|---------|----------------------|----------------|------------|
| 新增小功能 | ✅ 必須 | ❌ 不需要 | ⚠️ 標註進度 |
| 新增大功能 | ✅ 必須 | ✅ 建議 | ⚠️ 標註進度 |
| Bug 修復 | ⚠️ 視情況 | ❌ 不需要 | ❌ 不需要 |
| API 變更 | ✅ 必須 | ⚠️ 視影響範圍 | ❌ 不需要 |
| 重構 | ⚠️ 視影響 | ❌ 不需要 | ❌ 不需要 |

---

## 💡 最佳實踐

### ✅ 好的做法

1. **每次 git commit 檢查文件**
   ```bash
   git commit -m "feat: xxx" 之前確認 CLAUDE.md 已更新
   ```

2. **功能完成立即更新文件**
   ```
   不要累積多個功能再一次更新文件
   ```

3. **用程式碼驗證文件範例**
   ```typescript
   // 在 __tests__/ 中加入文件範例的測試
   test('CLAUDE.md 範例應該可執行', () => { ... });
   ```

### ❌ 應避免的做法

1. **不要在多處維護相同資訊**
   ```
   錯誤: API 文件同時在 CLAUDE.md、README.md、docs/api.md
   正確: API 文件只在 Package CLAUDE.md，其他引用連結
   ```

2. **不要讓計畫文件永遠處於「進行中」**
   ```
   完成後立即歸檔，開始新任務就建立新計畫文件
   ```

3. **不要假設 AI 會記得上次的狀態**
   ```
   每次對話開始時，AI 都會重新讀取 CLAUDE.md
   ```

---

## 🔄 定期維護任務

### 每週檢查 (開發中)
- [ ] 檢查 docs/plans/ACTIVE.md 是否需要更新狀態
- [ ] 檢查最近修改的 Package 是否更新了 CLAUDE.md

### 每月檢查
- [ ] 歸檔已完成的計畫文件
- [ ] 清理 docs/archive/ 超過 6 個月的舊文件
- [ ] 更新根目錄 CLAUDE.md 的專案概述

### 發布前檢查
- [ ] 所有 Package CLAUDE.md 的版本號已更新
- [ ] 根目錄 README.md 的版本號已更新
- [ ] 移除所有「實驗性」、「進行中」的標記

---

**文件維護原則**:
> 寧可文件稍微過時，也不要讓 AI 看到錯誤的「未來藍圖」當成「當前狀態」

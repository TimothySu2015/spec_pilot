# Fail-Fast æ¨¡å¼ç¯„ä¾‹ï¼šä½¿ç”¨è€…è¨»å†Šæµç¨‹
# æ­¤æµç¨‹å±•ç¤º Fail-Fast æ¨¡å¼çš„ä½¿ç”¨ï¼Œç•¶ä»»ä½•æ­¥é©Ÿå¤±æ•—æ™‚ç«‹å³åœæ­¢åŸ·è¡Œ

name: "ä½¿ç”¨è€…è¨»å†Šæµç¨‹ï¼ˆFail-Fast æ¨¡å¼ï¼‰"
description: "å±•ç¤º Fail-Fast æ¨¡å¼ï¼šé©—è­‰ç¢¼ -> è¨»å†Š -> ç™¼é€æ­¡è¿éƒµä»¶"
version: "1.0.0"

# å…¨åŸŸè¨­å®š
globals:
  baseUrl: "http://localhost:3000"
  headers:
    Content-Type: "application/json"

# åŸ·è¡Œé¸é …
options:
  failFast: true  # âœ… å•Ÿç”¨ Fail-Fast æ¨¡å¼ï¼šä»»ä½•æ­¥é©Ÿå¤±æ•—ç«‹å³åœæ­¢

# æ¸¬è©¦æ­¥é©Ÿ
steps:
  # æ­¥é©Ÿ 1: ç™¼é€é©—è­‰ç¢¼
  - name: "ç™¼é€é©—è­‰ç¢¼"
    description: "ç™¼é€é©—è­‰ç¢¼åˆ°ä½¿ç”¨è€…æ‰‹æ©Ÿ"
    request:
      method: POST
      path: /api/auth/send-verification-code
      body:
        phone: "+886912345678"
    expectations:
      status: 200
      custom:
        - type: notNull
          field: verificationId
    capture:
      verificationId: $.verificationId

  # æ­¥é©Ÿ 2: é©—è­‰ç¢¼ç¢ºèª
  # âš ï¸ å¦‚æœæ­¥é©Ÿ 1 å¤±æ•—ï¼Œæ­¤æ­¥é©Ÿå°‡è¢«è·³é
  - name: "é©—è­‰ç¢¼ç¢ºèª"
    description: "ç¢ºèªä½¿ç”¨è€…è¼¸å…¥çš„é©—è­‰ç¢¼"
    request:
      method: POST
      path: /api/auth/verify-code
      body:
        verificationId: "${verificationId}"
        code: "123456"
    expectations:
      status: 200
      custom:
        - type: notNull
          field: token
    capture:
      authToken: $.token

  # æ­¥é©Ÿ 3: å»ºç«‹ä½¿ç”¨è€…å¸³è™Ÿ
  # âš ï¸ å¦‚æœæ­¥é©Ÿ 2 å¤±æ•—ï¼Œæ­¤æ­¥é©Ÿå°‡è¢«è·³é
  - name: "å»ºç«‹ä½¿ç”¨è€…å¸³è™Ÿ"
    description: "ä½¿ç”¨é©—è­‰éçš„è³‡è¨Šå»ºç«‹å¸³è™Ÿ"
    request:
      method: POST
      path: /api/users
      headers:
        Authorization: "Bearer ${authToken}"
      body:
        name: "æ¸¬è©¦ä½¿ç”¨è€…"
        email: "test@example.com"
        phone: "+886912345678"
    expectations:
      status: 201
      custom:
        - type: notNull
          field: id
    capture:
      userId: $.id

  # æ­¥é©Ÿ 4: ç™¼é€æ­¡è¿éƒµä»¶
  # âš ï¸ å¦‚æœæ­¥é©Ÿ 3 å¤±æ•—ï¼Œæ­¤æ­¥é©Ÿå°‡è¢«è·³é
  - name: "ç™¼é€æ­¡è¿éƒµä»¶"
    description: "ç™¼é€æ­¡è¿éƒµä»¶çµ¦æ–°ä½¿ç”¨è€…"
    request:
      method: POST
      path: /api/notifications/welcome-email
      headers:
        Authorization: "Bearer ${authToken}"
      body:
        userId: "${userId}"
    expectations:
      status: 200
      custom:
        - type: notNull
          field: emailSent
        - type: contains
          field: status
          value: "sent"

# ğŸ“ ä½¿ç”¨èªªæ˜ï¼š
#
# 1. Fail-Fast æ¨¡å¼ç‰¹é»ï¼š
#    - ä»»ä½•æ­¥é©Ÿå¤±æ•— â†’ ç«‹å³åœæ­¢å¾ŒçºŒæ­¥é©Ÿ
#    - ç¯€çœæ™‚é–“èˆ‡è³‡æº
#    - é©åˆä¾è³´æ€§å¼·çš„æµç¨‹ï¼ˆæ¯å€‹æ­¥é©Ÿéƒ½ä¾è³´å‰ä¸€å€‹æ­¥é©Ÿçš„çµæœï¼‰
#
# 2. å°æ¯” Continue-On-Error æ¨¡å¼ï¼ˆé è¨­ï¼‰ï¼š
#    è‹¥è¦æ”¹ç‚º Continue-On-Error æ¨¡å¼ï¼Œåªéœ€ï¼š
#    options:
#      failFast: false  # æˆ–å®Œå…¨ç§»é™¤æ­¤è¡Œï¼ˆé è¨­ç‚º falseï¼‰
#
# 3. åŸ·è¡Œæ–¹å¼ï¼š
#    CLI: pnpm run start -- --spec specs/openapi.yaml --flow flows/user-registration-failfast-example.yaml
#    MCP: ä½¿ç”¨ runFlow å·¥å…·ä¸¦æŒ‡å®šæ­¤æª”æ¡ˆè·¯å¾‘
#
# 4. é æœŸè¡Œç‚ºï¼š
#    - å¦‚æœæ­¥é©Ÿ 1 å¤±æ•— â†’ åªåŸ·è¡Œ 1 å€‹æ­¥é©Ÿï¼Œè·³éæ­¥é©Ÿ 2ã€3ã€4
#    - å¦‚æœæ­¥é©Ÿ 2 å¤±æ•— â†’ åªåŸ·è¡Œ 2 å€‹æ­¥é©Ÿï¼Œè·³éæ­¥é©Ÿ 3ã€4
#    - å¦‚æœæ­¥é©Ÿ 3 å¤±æ•— â†’ åªåŸ·è¡Œ 3 å€‹æ­¥é©Ÿï¼Œè·³éæ­¥é©Ÿ 4
#    - å¦‚æœå…¨éƒ¨æˆåŠŸ â†’ åŸ·è¡Œå…¨éƒ¨ 4 å€‹æ­¥é©Ÿ
